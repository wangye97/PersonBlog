<template>
  <div>
        <div class="message" v-for="m in info" :key="m.id">
          <img :src="m.avatar" alt="">
          <div class="inner-content">
            <span>{{m.name}}</span>
            <h3>{{m.message}}</h3>
            <div class="bottom-content">
              <span>{{m.time}}</span>
              <svg @click="Like(m)" v-if="m.flag==1" t="1679540754197" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2428" width="16" height="16"><path d="M936.448 423.424c-16.384-23.552-48.128-35.328-99.84-35.328-28.672 0-59.392 3.072-88.576 6.144-20.48 2.048-39.936 4.096-53.248 4.096-10.752 0-19.968-0.512-28.16-2.048l-8.704-1.536 3.584-7.68c44.544-97.792 23.04-185.344 13.312-227.84l-0.512-1.536c-0.512-3.072-1.536-5.632-2.048-9.216-9.216-42.496-50.688-65.024-87.04-65.024-4.096 0-8.704 0.512-12.8 1.024-34.304 5.12-67.072 33.28-62.976 84.992 11.264 135.168-110.592 210.944-160.768 236.544-11.264-10.752-26.624-16.896-43.52-16.896H211.968c-35.328 0-64 28.672-64 64v383.488c0 35.328 28.672 64 64 64h93.696c16.384 0 31.232-6.144 42.496-16.384v0.512c38.4 0.512 101.888 5.12 158.72 10.24 54.272 4.096 105.984 8.704 133.12 8.704 57.856 0 129.536 0 185.344-36.352 49.664-32.768 63.488-120.832 75.264-199.168v-1.024c2.56-16.384 4.608-31.744 7.168-44.544 4.096-20.992 12.8-43.52 20.48-64.512 16.896-45.568 35.84-94.72 8.192-134.656zM309.76 832.512c0 4.096-3.584 7.68-7.68 7.68H215.552c-4.096 0-7.68-3.584-7.68-7.68V456.704c0-4.096 3.584-7.68 7.68-7.68h86.016c4.096 0 7.68 3.584 7.68 7.68v375.808z m558.592-299.52c-8.704 22.528-18.432 48.64-23.552 75.264-2.56 14.336-5.12 30.72-7.68 48.128-7.68 51.712-20.48 138.24-46.592 155.136-39.936 26.624-98.816 26.624-150.528 26.624-24.064 0-74.24-3.584-127.488-7.68h-0.512c-50.688-4.096-102.912-8.192-142.336-9.216v-353.28c51.712-25.088 218.624-120.32 203.264-302.592-1.024-14.848 3.584-15.872 8.704-16.384h3.584c10.752 0 22.528 5.632 25.088 14.336 0.512 3.072 1.536 7.168 2.56 11.776 9.728 39.936 27.648 115.2-14.848 197.632-9.728 18.432-9.728 38.4 0.512 54.784 14.848 23.552 47.104 35.84 95.744 35.84 16.384 0 36.352-2.048 60.416-4.608 26.624-2.56 56.32-6.144 82.432-6.144h4.608c27.136 0.512 36.864 4.608 40.448 6.656l1.024 0.512c8.192 12.288-3.584 43.008-14.848 73.216z" fill="#2C2C2C" p-id="2429"></path></svg>
              <svg @click="unLike(m)" v-else t="1679540891083" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2814" width="16" height="16"><path d="M635.74206853 896.62820014c-27.03653621 0-80.3414985-4.1048086-136.77527627-8.45860703-40.59591111-3.12881548-82.56713863-6.36568315-118.25959455-8.36229964l-1.70651986-0.27717734c-37.12062395-10.17569721-37.12062395-40.78030452-37.12062395-57.21833061V473.46295283c0-35.2708175 10.15925448-56.04619928 35.05706208-71.72668559 58.60656631-36.90217061 155.32854137-118.07520115 144.67248173-247.10243097-1.66541305-20.10945147 3.23804215-37.0219676 14.17245361-48.89831225 10.49985376-11.40772702 26.09930093-17.69354552 43.90794553-17.69354552 28.70899613 0 63.09425548 17.8380066 70.28090036 50.89375426 0.71173505 3.26153176 1.59024631 6.97288947 2.5615415 11.09061735 9.71999885 41.02342194 29.93397907 126.3952195-11.20454194 220.41706437-3.51639398 7.55778065-3.27914895 14.40969863 0.62952144 20.54400918 7.54016344 11.83053992 27.59793778 19.47288315 51.11338208 19.47288315 15.74508273 0 39.22529261-3.37545634 64.08316789-6.94939986 31.22238395-4.48651469 66.6141729-9.5743633 96.93573045-9.57436329 37.70434065 0 61.57800143 8.11213534 72.97046022 24.80502365 22.78021964 33.38577663 5.97810466 81.01212674-11.8082248 131.42551857-8.32001835 23.59061105-16.93013334 47.97986868-21.31211929 70.89985146-2.67194266 13.96457061-5.16888774 30.50125305-7.80559597 48.01392861-11.03306782 73.13136402-24.75334653 164.16415656-68.72001606 192.86610581-53.10882408 34.68122839-124.38920717 34.68122839-181.6721342 34.68122838z m-367.45025147-1.53856917h-77.6120063c-25.21021935 0-45.71899412-20.50290237-45.71899413-45.70607484V450.51360803c0-25.21021935 20.50877476-45.71899412 45.71899413-45.71899413h77.6120063c25.21021935 0 45.71899412 20.50877476 45.71899412 45.71899413v398.8640757c0 25.20904487-20.51464717 45.71194724-45.71899412 45.71194724z" fill="#1296db" p-id="2815"></path></svg>
                {{m.mount}}
              <svg t="1679540977314" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3841" width="16" height="16"><path d="M960 543.573333v-43.946666l-3.882667-5.12a138.24 138.24 0 0 0-19.712-44.586667c2.816-9.6 4.394667-19.541333 4.906667-29.610667 0.768-26.794667-6.912-52.48-23.125333-76.629333 2.304-7.893333 3.84-16.085333 4.394666-24.32 1.834667-28.672-5.802667-56.576-22.698666-83.072 3.2-15.104 4.010667-30.592 2.602666-45.909333-4.181333-55.466667-38.784-99.2-92.373333-116.778667-25.728-8.405333-50.773333-9.813333-72.021333-9.813333h-93.866667c-33.237333 0-66.944 0.213333-100.693333 0.213333-53.034667 0-106.325333-0.213333-159.232-0.213333h-1.109334 0.128-247.296c-39.808 0-72.021333 32.213333-72.021333 72.021333v368c0 39.808 32.213333 71.978667 72.021333 71.978667H249.173333s55.893333 6.4 82.346667 48.512c18.346667 29.312 36.053333 60.202667 53.12 90.026666l22.016 38.058667c1.792 2.986667 2.602667 6.4 2.218667 9.898667-0.896 20.736-1.28 41.6-1.706667 61.696-0.213333 11.946667-0.512 24.234667-0.810667 36.224-0.981333 36.181333 16.810667 65.706667 49.92 83.114666a140.8 140.8 0 0 0 65.792 16.469334c19.498667 0 39.253333-4.096 58.88-12.288 25.514667-10.666667 43.52-29.781333 53.717334-56.789334l8.96-23.594666c8.234667-21.333333 16.64-43.434667 24.234666-65.621334 12.288-35.712 13.909333-74.88 5.12-119.808-2.602667-13.397333-4.906667-26.794667-7.125333-40.789333h21.589333l64.128 0.085333c29.184 0 58.666667 0 87.893334-0.170666h0.810666c16.768 0 33.493333-2.730667 49.493334-8.106667 23.594667-8.405333 54.272-28.416 66.56-76.714667l1.237333-4.010666 0.853333-2.986667 1.536-5.376z m-712.021333-39.594666H136.021333V135.978667h112.042667v368z m640 28.8c0 1.536-0.981333 3.541333-1.578667 5.632-4.608 18.090667-12.501333 23.466667-20.394667 26.368-8.405333 2.816-17.066667 4.224-25.898666 4.224h-0.426667l-0.469333-0.085334-0.512-0.128c-31.018667 0.213333-61.482667 0.298667-87.296 0.298667h-32.298667l-31.786667-0.085333h-106.24l13.653334 83.626666c2.56 15.872 4.864 29.354667 7.552 43.093334 6.314667 32.170667 5.546667 59.093333-2.474667 82.474666-6.997333 20.181333-14.421333 39.808-23.424 63.317334-3.072 7.978667-6.101333 16.085333-9.088 23.978666-3.584 9.6-8.106667 13.098667-14.08 15.701334-10.709333 4.522667-21.12 6.698667-31.146667 6.698666-11.093333 0-21.674667-2.688-32.384-8.277333a24.661333 24.661333 0 0 1-9.386666-7.68c-0.512-0.853333-2.133333-3.413333-1.92-9.642667 0.341333-11.52 0.64-22.997333 0.853333-36.778666v-1.706667c0.384-18.773333 0.768-38.314667 1.450667-57.173333a86.954667 86.954667 0 0 0-11.904-50.346667c-2.56-4.394667-5.077333-8.874667-7.68-13.269333-4.608-8.021333-9.386667-16.213333-13.909334-24.234667l-0.085333-0.085333-0.085333-0.085334-0.725334-1.109333c-17.194667-29.994667-34.986667-61.013333-53.674666-91.008l-0.128-0.213333-0.085334-0.170667c-16.64-26.325333-41.088-47.701333-71.509333-62.421333l-0.597333-387.712h63.914666c55.68 0 111.872 0.341333 159.402667 0.341333 16.981333 0 33.962667-0.128 50.773333-0.128 16.725333 0 33.28-0.213333 49.92-0.213333h93.866667c16.213333 0 33.536 0.938667 49.706667 6.229333 13.013333 4.181333 23.296 11.306667 30.634666 20.48 7.168 9.130667 11.264 20.224 12.288 33.28v0.64l0.085334 0.597333c0.810667 8.192 0.298667 16.298667-1.408 24.32l-0.768 3.413334h-8.704 8.704l-5.333334 25.173333 15.786667 25.002667c8.533333 13.397333 12.330667 26.282667 11.648 39.381333-0.213333 2.986667-0.853333 5.973333-1.621333 8.917333l-9.514667 32.298667 18.816 27.989333c7.594667 11.306667 11.093333 22.016 10.922667 33.493334-0.298667 4.266667-1.024 8.618667-2.218667 12.714666l-9.301333 32.426667 18.901333 27.861333c4.394667 6.4 7.509333 13.482667 9.301333 21.12l1.877334 7.765334v13.696z" fill="#000000" opacity=".65" p-id="3842"></path></svg>
            </div>
          </div>          
        </div>
        
        <div class="comment">
            <img :src="getUserInfo.avatar" alt="">
            <input type="text" v-model="submitInfo.message" class="input" placeholder="快来发表评论吧!!!">
            <el-button type="primary" round @click="submit">发布</el-button>
        </div>
  </div>
</template>

<script>
import { reqGetMessageInfo,reqUpdateLikeState,reqSubmitComment } from "@/api";
import moment from "moment";
import { mapState } from 'vuex';
export default {
  name: "Message",
  props: ["title"],
  data() {
    return {
      info: [],
      submitInfo:{
        message:'',
        avatar:'',
        name:'',
        type:this.title,
        flag:1,
        // time:''
      }
    };
  },
  computed:{
    ...mapState({getUserInfo:(state)=>state.user.userInfo})
  },
  methods:{
    updateState(m){
      reqUpdateLikeState({flag:m.flag,mount:m.mount,id:m.id})
    },
     Like(m){
      m.flag=0;
      m.mount++
      this.updateState(m)
    },
    unLike(m){
      m.flag=1;
      m.mount--
      this.updateState(m)
    },
    async submit(){
      if(this.submitInfo.message==''){
        this.$message('评论不能为空')
      }else{
        this.submitInfo.avatar=this.getUserInfo.avatar
        this.submitInfo.name=this.getUserInfo.username
        let result=await reqSubmitComment(this.submitInfo)
        if(result.status==200){
          this.submitInfo.message=''
          this.submitInfo.time=moment().format('YYYY-MM-DD hh:mm')
          this.$message.success('评论成功')
          this.getMessageInfo()
        }
      }
    },
    async getMessageInfo(){
      try {
      let result = await reqGetMessageInfo(this.title);
      if (result.status == 200) {
        this.info = result.data;
      }
    } catch (e) {
      console.log(e);
    }
    }
  },
  async mounted() {
    this.getMessageInfo()
   

  },
};
</script>

<style scoped>
  .message{
    width: 40%;
    height: 100px;
    margin: 0 auto;
    /* background: #bfa; */
    border-bottom: 1px solid gray;
    display: flex;
    padding-top: 3px;
  }
  .message img{
    width: 50px;
    height: 50px;
    border-radius: 50%;
  }
  .message .inner-content{
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-evenly;
    margin-left: 10px;
  }
  .message .bottom-content{
    width: 30%;
    justify-content: space-between;
    display: flex; 
    align-items: center;
  }
  .comment{
    width: 40%;
    height: 60px;
    margin: 0px auto;
    margin-top: 50px;
    position: sticky;
    bottom: 0;
    display: flex;
    justify-content: space-evenly;
    align-items: center;
}
  .comment img{
    width: 50px;
    height: 50px;
    border-radius: 50%;
  }
  .comment .input{
    width: 60%;
    height: 30px;
    background-color: rgb(241, 242, 243);
    border-radius: 5px;
  }
  .comment .input:hover{
    background-color: rgb(255, 255, 255);
  }

  @media only screen and (max-width:768px) {
    .message{
      width: 100%;
    }
  }
</style>